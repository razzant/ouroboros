
# WORLD.md

Этот файл описывает «картину мира» проекта и протоколы.

## Неподвижные основы

- Boot-ячейка Colab — неизменяема.
- `/panic` и `/restart` обрабатываются супервизором (не LLM) и неизменны.
- Секреты никогда не логируются и не коммитятся.

## Протокол веток

- main: человек (Cursor)
- ouroboros: агент
- ouroboros-stable: откат

## Протокол логирования

- Логи в Drive: `MyDrive/Ouroboros/logs/*.jsonl`
- Каждое существенное действие пишется в logs/events.jsonl и logs/tools.jsonl
- В чат добавляется бюджетная строка, но **не на каждое сообщение**: она показывается по cadence сообщений (по умолчанию раз в 10). `/status` печатает бюджет всегда.

## Протокол инструментов правок

- Если доступен Claude Code CLI (`ANTHROPIC_API_KEY` + `claude`), основной инструмент редактирования кода — `claude_code_edit(...)`.
- Для сложных и/или многофайловых задач сначала выбирается `claude_code_edit(...)`, затем `repo_commit_push(...)`.
- `repo_write_commit(...)` используется как fallback для маленьких детерминированных правок, где финальный контент заранее ясен.
- В evolution-режиме приоритет `claude_code_edit(...)` должен соблюдаться максимально часто, без нарушения веточного протокола.

## Протокол рабочей памяти

- Рабочая память хранится в `MyDrive/Ouroboros/memory/scratchpad.md`.
- После каждой задачи формируется компактная дельта (без воды) и пишется в `memory/scratchpad_journal.jsonl`.
- В `RecentEvidence` добавляются короткие цитаты ключевых команд и ошибок (если были).
- Актуальный self-model хранится в `MyDrive/Ouroboros/memory/identity.md` и обновляется периодически на основе фактических логов/журнала.

## Протокол idle-поведения

- Idle-задачи ставятся только когда нет активных/ожидающих задач владельца.
- Idle-задачи ограничены cooldown, бюджетным порогом и дневным лимитом.
- Типы idle-задач: консолидация памяти, анализ производительности, идеи улучшений, web learning, проактивные предложения владельцу.

## Протокол реиндексации

Полная реиндексация summaries (drive/index/summaries.json) должна запрашивать OK владельца.
